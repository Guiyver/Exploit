if _G.iuUHVZ90di0p3ZhVnmxjFAybfiYuvEFK4aWKL0aEMwrRaTuO3jZWdz == "iuUHVZ90di0p3ZhVnmxjFAybfiYuvEFK4aWKL0aEMwrRaTuO3jZWdz" then return end _G.iuUHVZ90di0p3ZhVnmxjFAybfiYuvEFK4aWKL0aEMwrRaTuO3jZWdz = "iuUHVZ90di0p3ZhVnmxjFAybfiYuvEFK4aWKL0aEMwrRaTuO3jZWdz"

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local player = Players.LocalPlayer
local Mouse = player:GetMouse()

local UnitFolder = Workspace:WaitForChild("Units")

local UnitGui = Instance.new("ScreenGui")
local UnitTextBox = Instance.new("TextBox")

UnitGui.Parent = CoreGui
UnitGui.Name = "Unit Gui"

UnitTextBox.Parent = UnitGui
UnitTextBox.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
UnitTextBox.Position = UDim2.new(0, 0, 1, -25)
UnitTextBox.Size = UDim2.new(0, 150, 0, 25)
UnitTextBox.Font = Enum.Font.SourceSans
UnitTextBox.Text = "Type Unit Name"
UnitTextBox.TextColor3 = Color3.new(1, 1, 1)
UnitTextBox.TextScaled = true
UnitTextBox.TextSize = 14
UnitTextBox.TextWrapped = true
UnitTextBox.BackgroundTransparency = 0.6


local function PlaceUnit(placeposition)
    local args = {
        [1] = UnitTextBox.Text,
        [2] = placeposition
    }
    game:GetService("ReplicatedStorage").Remote.SpawnUnit:InvokeServer(unpack(args))
end

local function UpgradeUnit(unit)
    local args = {
        [1] = unit
    }
    game:GetService("ReplicatedStorage").Remote.UpgradeUnit:InvokeServer(unpack(args))
end

local function onMouseClick(mouse)
    local ray = Ray.new(
        mouse.UnitRay.Origin,
        mouse.UnitRay.Direction * 1000
    )
    local hit, position = game.Workspace:FindPartOnRay(ray, game.Players.LocalPlayer.Character, false, true)
    if hit then
        local clickedCFrame = CFrame.new(position)
        clickedCFrame = clickedCFrame * CFrame.new(0,2.7,0)
        if clickedCFrame then
            PlaceUnit(clickedCFrame)
        end
    end
end

Mouse.Button1Down:Connect(function()
    if not game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.LeftControl) then return end
    if not Mouse.Target then return end
    onMouseClick(Mouse)
end)

while true do
    if AutoUpgrade then
        local upgradeableunit = nil
        for _,unit in pairs(UnitFolder:GetChildren()) do
            if unit:FindFirstChild("Info") and unit.Info:FindFirstChild("UpgradeCost") and unit.Info:FindFirstChild("Owner") then
                if unit.Info.Owner.Value ~= unit.Name and unit.Info.UpgradeCost.Value > 0 and unit.Info.UpgradeCost.Value <= player:WaitForChild("leaderstats"):WaitForChild("Cash").Value then
                    if OnlyUpgradeOwned then
                        if unit.Info.Owner.Value == player.Name then
                            upgradeableunit = unit
                            break
                        end
                    else
                        upgradeableunit = unit
                        break
                    end
                end
            end
        end
        if upgradeableunit then
            -- print("Upgraded " .. upgradeableunit.Name)
            UpgradeUnit(upgradeableunit)
            task.wait(.2)
        else
            task.wait()
        end
    else
        task.wait()
    end
end
