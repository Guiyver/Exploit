--V5
if _G.QeIAvfMGdZxJepfeF8Nu8Lzd4cuIjAo == "QeIAvfMGdZxJepfeF8Nu8Lzd4cuIjAo" then return end _G.QeIAvfMGdZxJepfeF8Nu8Lzd4cuIjAo = "QeIAvfMGdZxJepfeF8Nu8Lzd4cuIjAo"

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
Player.CharacterAdded:Connect(function(v) Character = v end)
local UIS = game:GetService("UserInputService")

local NoClip = false
local Magnet = false
local CameraOn = false
local TweenService = nil
local RealGravity = tonumber(game.Workspace.Gravity)
local NoClipPartsTable = {}

local Speed = Character:WaitForChild("Humanoid").WalkSpeed
local OriginalSpeed = tonumber(Speed)
local Attacking = false
local TargetPlayer = nil
local Text


local function GetMagnetPosition()
    if MagnetPosition == "Over" then
        CFrame1 = 0
        CFrame2 = MagnetDistance
        CFrame3 = 0
        CFrameAngle1 = -90
        CFrameAngle2 = 0
        CFrameAngle3 = 0
    elseif MagnetPosition == "Under" then
        CFrame1 = 0
        CFrame2 = -MagnetDistance
        CFrame3 = 0
        CFrameAngle1 = 90
        CFrameAngle2 = 0
        CFrameAngle3 = 0
    elseif MagnetPosition == "Behind" then
        CFrame1 = 0
        CFrame2 = 0
        CFrame3 = MagnetDistance
        CFrameAngle1 = 0
        CFrameAngle2 = 0
        CFrameAngle3 = 0
    elseif MagnetPosition == "Front" then
        CFrame1 = 0
        CFrame2 = 0
        CFrame3 = -MagnetDistance
        CFrameAngle1 = 0
        CFrameAngle2 = 3.1
        CFrameAngle3 = 0
    elseif MagnetPosition == "Stand" then
        CFrame1 = 0
        CFrame2 = 0
        CFrame3 = -MagnetDistance
        CFrameAngle1 = 0
        CFrameAngle2 = 0
        CFrameAngle3 = 0
    elseif MagnetPosition == "GuardBack" then
        CFrame1 = 0
        CFrame2 = 0
        CFrame3 = MagnetDistance
        CFrameAngle1 = 0
        CFrameAngle2 = 3.1
        CFrameAngle3 = 0
    elseif MagnetPosition == "Platform" then
        CFrame1 = 0
        CFrame2 = -MagnetDistance
        CFrame3 = 0
        CFrameAngle1 = 0
        CFrameAngle2 = 0
        CFrameAngle3 = 0
    end
end

local function tween(target)
    GetMagnetPosition()
    target = target*CFrame.new(CFrame1,CFrame2,CFrame3) * CFrame.Angles(math.rad(CFrameAngle1), (CFrameAngle2), (CFrameAngle3))
    TweenService = game:GetService("TweenService"):Create(Character.HumanoidRootPart, TweenInfo.new(Player:DistanceFromCharacter(target.Position)/MagnetSpeed, Enum.EasingStyle.Linear), {CFrame = target})
    if Magnet then
        TweenService:Play()
        local timerdone = false
        task.spawn(function()
            task.wait(Player:DistanceFromCharacter(target.Position)/MagnetSpeed or not Magnet)
            timerdone = true
        end)
        local currentcharacter = Character
        while Magnet and currentcharacter and timerdone == false do
            task.wait()
        end
    end
end

--Target Gui
local TargetGui = Instance.new("ScreenGui")
local TargetTextBox = Instance.new("TextBox")

TargetGui.Parent = game:GetService("CoreGui")
TargetGui.Name = "Target Gui"

TargetTextBox.Parent = TargetGui
TargetTextBox.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
TargetTextBox.Position = UDim2.new(0, 0, 1, -25)
TargetTextBox.Size = UDim2.new(0, 150, 0, 25)
TargetTextBox.Font = Enum.Font.SourceSans
TargetTextBox.Text = "Insert Player Name"
TargetTextBox.TextColor3 = Color3.new(1, 1, 1)
TargetTextBox.TextScaled = true
TargetTextBox.TextSize = 14
TargetTextBox.TextWrapped = true
TargetTextBox.BackgroundTransparency = 0.6

local function Action(Object, Function) if Object ~= nil then Function(Object) end end
--Button Activate
UIS.InputBegan:connect(function(UserInput,gameProcessed)
    local TeleportToPlayerKeyUpper = TeleportToPlayerKey:upper()
    local MagnetKeyUpper = MagnetKey:upper()
    local NoClipKeyUpper = NoClipKey:upper()
    local SetCameraUpper = SetCamera:upper()
    local FallKeyUpper = FallKey:upper()
    local AttackKeyUpper = AttackKey:upper()
    local CopyPlayerListKeyUpper = CopyPlayerListKey:upper()
    if UserInput.UserInputType == Enum.UserInputType.Keyboard and gameProcessed == false then
        Text = string.lower(TargetTextBox.Text)
        local playerfound = false
        if playerfound == false then
            for i,v in pairs(Players:GetPlayers()) do
                if string.lower(v.Name) == Text then
                    playerfound = true
                    TargetPlayer = v
                    break
                end
            end
        end
        if playerfound == false then
            for i,v in pairs(Players:GetPlayers()) do
                if string.lower(v.DisplayName) == Text then
                    playerfound = true
                    TargetPlayer = v
                    break
                end
            end
        end
        if playerfound == false then
            for _,v in pairs(Players:GetPlayers()) do
                local playername = string.lower(v.Name)
                if string.find(playername,Text) then
                    playerfound = true
                    TargetPlayer = v
                    break
                end
            end
        end
        if playerfound == false then
            for i,v in pairs(Players:GetPlayers()) do
                local playername = string.lower(v.DisplayName)
                if string.find(playername,Text) then
                    playerfound = true
                    TargetPlayer = v
                    break
                end
            end
        end
    --Infinite Jump
        if InfiniteJumpOn and UserInput.KeyCode == Enum.KeyCode.Space then
            Action(Character.Humanoid, function(self)
                if self:GetState() == Enum.HumanoidStateType.Jumping or self:GetState() == Enum.HumanoidStateType.Freefall then
                    Action(self.Parent.HumanoidRootPart, function(self)
                        self.Velocity = Vector3.new(0, InfiniteJumpHeight, 0)
                    end)
                else
                    pcall(function()
                        if Character.Humanoid.JumpPower <= 5 then
                            Action(self.Parent.HumanoidRootPart, function(self)
                                self.Velocity = Vector3.new(0, InfiniteJumpHeight, 0)
                            end)
                        end
                    end)
                end
            end)
        end
    --TeleportToPlayer
        if UserInput.KeyCode == Enum.KeyCode[TeleportToPlayerKeyUpper] then
            if TargetPlayer and TargetPlayer.Character and TargetPlayer.Character:FindFirstChild("HumanoidRootPart") and Character and Character:FindFirstChild("HumanoidRootPart") then
                Character:FindFirstChild("HumanoidRootPart").CFrame = TargetPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame * CFrame.new(0,2,0)
            end
        end
    --SetCameraToPlayer
        if UserInput.KeyCode == Enum.KeyCode[SetCameraUpper] then
            CameraOn = not CameraOn
        end
    --Magnet
        if UserInput.KeyCode == Enum.KeyCode[MagnetKeyUpper] then
            if Magnet == false then
                Magnet = true
                --NoClip = true
                while Magnet == true do
                    game.Workspace.Gravity = 0
                    if Character and Character:FindFirstChild("HumanoidRootPart") then
                        -- Character:FindFirstChild("HumanoidRootPart").Anchored = true
                        if TargetPlayer and TargetPlayer.Character and TargetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                            tween(TargetPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame)
                        else
                            task.wait()
                        end
                    else
                        task.wait()
                    end
                end
                -- if Character and Character:FindFirstChild("HumanoidRootPart") then
                --     Character:FindFirstChild("HumanoidRootPart").Anchored = false
                -- end
                pcall(function() TweenService:Cancel() end)
                game.Workspace.Gravity = RealGravity
            else
                Magnet = false
                --NoClip = false
            end
        end
    --NoClip
        if UserInput.KeyCode == Enum.KeyCode[NoClipKeyUpper] then
            if NoClip == false then
                NoClip = true
                for _,v in pairs(Character:GetDescendants()) do
                    if v:IsA("BasePart") then
                        if v.CanCollide == true then
                            table.insert(NoClipPartsTable,v)
                        end
                    end
                end
            else
                NoClip = false
                for _,v in pairs(NoClipPartsTable) do
                    v.CanCollide = true
                end
                table.clear(NoClipPartsTable)
                --game.Workspace.Gravity = RealGravity
            end
        end
    --Fall
        if UserInput.KeyCode == Enum.KeyCode[FallKeyUpper] then
            if FallOn and Character and Character:FindFirstChild("HumanoidRootPart") then
                Character:FindFirstChild("HumanoidRootPart").CFrame = Character:FindFirstChild("HumanoidRootPart").CFrame * CFrame.new(0,-3,0)
            end
        end
	--Attack
		if UserInput.KeyCode == Enum.KeyCode[AttackKeyUpper] then
            if Attacking then
                Attacking = false
                --Character:FindFirstChild("HumanoidRootPart").Anchored = false
            else
                Attacking = true
            end
		end
    --CopyPlayerList
        if UserInput.KeyCode == Enum.KeyCode[CopyPlayerListKeyUpper] then
            local Playerlist = ""
            for i,player in pairs(Players:GetPlayers()) do
                if player ~= Player then
                    Playerlist ..= i .. ". " .. player.DisplayName .. " / " .. player.Name .. "   "
                end
            end
            setclipboard(Playerlist)
        end
    end
end)

--Speed
local SpeedScreenGui = Instance.new("ScreenGui")
local SpeedTextBox = Instance.new("TextBox")

SpeedScreenGui.Parent = game:GetService("CoreGui")
SpeedScreenGui.Name = "Speed Gui"

SpeedTextBox.Parent = SpeedScreenGui
SpeedTextBox.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
SpeedTextBox.Position = UDim2.new(0, 0, 1, -50)
SpeedTextBox.Size = UDim2.new(0, 150, 0, 25)
SpeedTextBox.Font = Enum.Font.SourceSans
SpeedTextBox.Text = "Set Speed. Current Speed: " .. Character.Humanoid.WalkSpeed
SpeedTextBox.TextColor3 = Color3.new(1, 1, 1)
SpeedTextBox.TextScaled = true
SpeedTextBox.TextSize = 14
SpeedTextBox.TextWrapped = true
SpeedTextBox.BackgroundTransparency = 0.6
SpeedTextBox.FocusLost:Connect(function()
    if tonumber(SpeedTextBox.Text) ~= nil then
        Speed = tonumber(SpeedTextBox.Text)
    end
    SpeedTextBox.Text = "Current Speed: " .. Speed .. ". Orignal Speed: " .. OriginalSpeed .. "."
end)

task.spawn(function()
    while true do
        --pcall(function()
            if AttackOn then
                if Attacking and Character then
                    local Tool = Character:FindFirstChildWhichIsA("Tool")
                    if Tool then
                        if TargetPlayer and TargetPlayer.Character and TargetPlayer.Character:FindFirstChild("Humanoid") and TargetPlayer.Character.Humanoid.Health > 0 then
                            -- if Tool and Tool:FindFirstChild("Handle") and Tool.Handle.CanTouch == true then
                            --     for _,v in pairs(TargetPlayer.Character:GetChildren()) do
                            --         if v:IsA("BasePart") and v.CanTouch == true then
                            --             firetouchinterest(Tool.Handle,v,0)
                            --             firetouchinterest(Tool.Handle,v,1)
                            --         end
                            --     end
                            -- else
                                for _,v in pairs(Tool:GetDescendants()) do
                                    if v:IsA("BasePart") and v.CanTouch == true then
                                        for _,v2 in pairs(TargetPlayer.Character:GetChildren()) do
                                            if v2:IsA("BasePart") and v.CanTouch == true then
                                                firetouchinterest(v,v2,0)
                                                firetouchinterest(v,v2,1)
                                            end
                                        end
                                    end
                                end
                            --end
                        end
                        if AttackAllWithinRadius then
                            for _,v in pairs(Players:GetPlayers()) do
                                if v ~= Player and Character:FindFirstChild("HumanoidRootPart") and v.Character and v.Character:FindFirstChild("HumanoidRootPart") and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 then
                                    if (Character.HumanoidRootPart.Position - v.Character.HumanoidRootPart.Position).Magnitude <= AttackRadius then
                                        -- if Tool and Tool:FindFirstChild("Handle") and Tool.Handle.CanTouch == true then
                                        --     for _,v2 in pairs(v.Character:GetChildren()) do
                                        --         if v2:IsA("BasePart") and v.CanTouch == true then
                                        --             firetouchinterest(Tool.Handle,v2,0)
                                        --             firetouchinterest(Tool.Handle,v2,1)
                                        --         end
                                        --     end
                                        -- else
                                            for _,v2 in pairs(Tool:GetDescendants()) do
                                                if v2:IsA("BasePart") and v2.CanTouch == true then
                                                    for _,v3 in pairs(v.Character:GetChildren()) do
                                                        if v3:IsA("BasePart") and v3.CanTouch == true then
                                                            firetouchinterest(v2,v3,0)
                                                            firetouchinterest(v2,v3,1)
                                                        end
                                                    end
                                                end
                                            end
                                        --end
                                    end
                                end
                            end
                        end
                    end
                end
            end
        --end)
        task.wait()
    end
end)

game:GetService("RunService").Stepped:Connect(function()
    Text = TargetTextBox.Text
    if Players:FindFirstChild(Text) then
        TargetPlayer = Players[Text]
    else
        for i,v in pairs(Players:GetPlayers()) do
            if v.DisplayName == Text then
                TargetPlayer = v
            end
        end
    end
    pcall(function()
--Speed Hacks
        if SpeedOn then
            Character.Humanoid.WalkSpeed = Speed
        end
--NoClip cont.
        if NoClip then
            for _,v in pairs(NoClipPartsTable) do
                v.CanCollide = false
            end
            --Originally the below was the code, but roblox patched. Temporary solution to go through walls until proper fix.
            --Character.Humanoid:ChangeState(11)
            --game.Workspace.Gravity = 0
        end
--SetCameraToPlayer cont.
        if CameraOn and Camera then
            CurrentCameraTarget = Text
            game.Workspace.CurrentCamera.CameraSubject = TargetPlayer.Character.HumanoidRootPart
            game.Workspace.CurrentCamera.CameraType = "Custom"
            Player.CameraMode = Enum.CameraMode.Classic
        elseif Camera then
            CurrentCameraTarget = nil
            if Character and Character:FindFirstChild("Humanoid") then
                game.Workspace.CurrentCamera.CameraSubject = Character.Humanoid
                game.Workspace.CurrentCamera.CameraType = "Custom"
                Player.CameraMode = Enum.CameraMode.Classic
            end
        end
    end)
end)

local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Systems = ReplicatedStorage:WaitForChild("Systems")
local Combat = Systems:WaitForChild("Combat")

local UseSkill = Systems:WaitForChild("Skills"):WaitForChild("UseSkill")
local PlayerAttack = Combat:WaitForChild("PlayerAttack")
local PlayerSkillAttack = Combat:WaitForChild("PlayerSkillAttack")
local Pickup = Systems:WaitForChild("Drops"):WaitForChild("Pickup")
local Drops = ReplicatedStorage:WaitForChild("Drops")
local Mobs = workspace:WaitForChild("Mobs")
local BossArenas = workspace:WaitForChild("BossArenas")

--Funcs
local function extractNumbersFromString(str)
    local numericString = string.gsub(str, "%D", "")
    local number = tonumber(numericString)
    return number
end

local function CheckForCharacter()
    if Character and Character:FindFirstChild("HumanoidRootPart") then
        return true
    else
        return false
    end
end
local function GetDistanceFromCharacter(Object)
    assert(Object:IsA("Model") or Object:IsA("BasePart"), "Script broke, this shouldn't have happened.")
    if not Character or not Character:FindFirstChild("HumanoidRootPart") then print("Can't find character.") return end
    local Position = Object:IsA("Model") and Object.HumanoidRootPart.Position or Object.Position
    return (Position - Character.HumanoidRootPart.Position).Magnitude
end

local function Attack()
    local attacked = false
    local attacktable = {}
    for _,v in pairs(Mobs:GetChildren()) do
        if CheckForCharacter() and v:IsA("Model") and v:FindFirstChild("PKIndicator") and v:FindFirstChild("HumanoidRootPart") and v.PKIndicator.Transparency == 0 and GetDistanceFromCharacter(v) < MaxDistance then
            table.insert(attacktable,v)
        end
    end
    if #attacktable > 0 then
        attacked = true
        PlayerAttack:FireServer(attacktable)

        local args = {
            [1] = "Whirlwind"
        }
        UseSkill:FireServer(unpack(args))
        for i = 1,3 do
            local args = {
                [1] = {attacktable},
                [2] = "Whirlwind",
                [3] = i
            }
            PlayerSkillAttack:FireServer(unpack(args))
        end
        task.wait(AttackSpeed)
    end
    return attacked
end


--Get rid of clutter
-- workspace.ChildAdded:Connect(function(Child)
--     if Child:IsA("Part") and (Child.Name == "Part" or Child.Name == "DamageNumber") then
--         task.wait()
--         task.spawn(Child.Destroy, Child)
--     end
-- end)

-- workspace.Effects.ChildAdded:Connect(function(Child)
--     if Child.Name == "HitEffect" then
--         task.wait()
--         task.spawn(Child.Destroy, Child)
--     end
-- end)

-- for _,v in next, getgc(true) do if typeof(v) == "table" and rawget(v, "ShowDamageNumber") then rawset(v, "ShowDamageNumber", function()end) end end

task.spawn(function()
    while true do
        if KillAura then
            local attacked = Attack()
            if not attacked then
                task.wait()
            end
        else
            task.wait()
        end
    end
end)
task.spawn(function()
    -- Auto pickup
    while true do
        if AutoPickUp then
            for i,v in pairs(Drops:GetChildren()) do
                if v:IsA("Folder") then
                    Pickup:FireServer(v)
                end
            end
        end
        task.wait(1)
    end
end)
task.spawn(function()
    --AutoTroll
    while true do
        if AutoTroll and Attacking and CheckForCharacter() and TargetPlayer and TargetPlayer.Character and TargetPlayer.Character:FindFirstChild("HumanoidRootPart") and Character and Character:FindFirstChild("HumanoidRootPart") then
            Character:FindFirstChild("HumanoidRootPart").CFrame = TargetPlayer.Character:FindFirstChild("HumanoidRootPart").CFrame * CFrame.new(0,-50,0)
        end
        if KillPlayer and workspace.Characters:FindFirstChild(TargetPlayer.Name) then
            local args = {
                [1] = {
                    [1] = workspace.Characters[TargetPlayer.Name]
                }
            }
            game:GetService("ReplicatedStorage"):WaitForChild("Systems"):WaitForChild("Combat"):WaitForChild("PlayerAttack"):FireServer(unpack(args))
        task.wait()
    end
end)
